{% extends "procurement/base.html" %}
{% load static %}
{% block content %}

<h4>Enter Bid Prices — {{ bid.supplier.name }}</h4>
<p class="text-muted">RFQ: {{ rfq.purchase_request.pr_number }}</p>

<form method="post" id="bidLinesForm">
  {% csrf_token %}
  {{ formset.management_form }}

  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-light text-center">
        <tr>
          <th style="width:10%">Stock No.</th>
          <th style="width:35%; text-align:left;">Item Description</th>
          <th style="width:8%">Qty</th>
          <th style="width:10%">Unit</th>
          <th style="width:15%">Offer</th>
          <th style="width:15%; text-align:left;">Unit Price</th>
          <th style="width:7%">Compliant?</th>
          <th style="width:5%">Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for form in formset.forms %}
        {% with pr_item=form.instance.pr_item %}
        <tr>
          <!-- ✅ Stock Number (center) -->
          <td class="text-center">{{ pr_item.stock_no }}</td>

          <!-- Item Description (left) -->
          <td class="text-start">
            {{ pr_item.description }}
            {{ form.id }}
            {{ form.pr_item.as_hidden }}
          </td>

          <!-- Quantity (center) -->
          <td class="text-center">{{ pr_item.quantity }}</td>

          <!-- Unit (center) -->
          <td class="text-center">{{ pr_item.unit }}</td>

          <!-- Offer (center) -->
          <td class="text-center">{{ form.offer }}</td>

          <!-- Unit Price (right) -->
          <td class="text-end">{{ form.unit_price }}</td>

          <!-- Compliant (center) -->
          <td class="text-center">{{ form.compliant }}</td>

          <!-- Delete (center) -->
          <td class="text-center">{{ form.DELETE }}</td>

          <!-- Hidden PR Item link -->
          {{ form.pr_item.as_hidden }}
        </tr>
        {% endwith %}
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-3">
    <button type="submit" class="btn btn-maroon">Save Bid Lines</button>
    <a href="{% url 'procurement:rfq_process' rfq.pk %}" class="btn btn-outline-secondary">Cancel</a>
  </div>
</form>

{% endblock %}
